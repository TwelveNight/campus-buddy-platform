<!DOCTYPE html>
<html>

<head>
    <title>WebSocketæµ‹è¯•</title>
    <meta charset="UTF-8">
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        h2 {
            color: #333;
            border-bottom: 2px solid #007bff;
            padding-bottom: 10px;
        }

        #messages {
            border: 1px solid #ddd;
            padding: 15px;
            height: 300px;
            overflow-y: auto;
            margin-bottom: 15px;
            background-color: #f9f9f9;
            border-radius: 4px;
            font-family: monospace;
        }

        .controls {
            margin-bottom: 15px;
        }

        .button-group {
            margin-bottom: 10px;
        }

        input,
        button {
            padding: 8px 12px;
            margin-right: 8px;
            border-radius: 4px;
            border: 1px solid #ddd;
        }

        button {
            background-color: #007bff;
            color: white;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        button:hover {
            background-color: #0056b3;
        }

        button.disconnect {
            background-color: #dc3545;
        }

        button.disconnect:hover {
            background-color: #c82333;
        }

        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            font-weight: bold;
        }

        .status.connected {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status.disconnected {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .endpoint-label {
            font-weight: bold;
            color: #666;
            margin-right: 5px;
        }
    </style>
</head>

<body>
    <div class="container">
        <h2>WebSocket Echoæµ‹è¯•</h2>

        <div id="status" class="status disconnected">çŠ¶æ€: æœªè¿æ¥</div>

        <div id="messages"></div>

        <div class="controls">
            <div class="button-group">
                <span class="endpoint-label">JSR356ç«¯ç‚¹:</span>
                <button onclick="connectJSR356()">è¿æ¥ /ws/echo</button>
            </div>
            <div class="button-group">
                <span class="endpoint-label">Springç«¯ç‚¹:</span>
                <button onclick="connectSpring()">è¿æ¥ /ws/spring-echo</button>
            </div>
            <div class="button-group">
                <span class="endpoint-label">å¤‡ç”¨ç«¯ç‚¹:</span>
                <button onclick="connectFallback()">è¿æ¥ /ws/fallback</button>
            </div>
            <div class="button-group">
                <button class="disconnect" onclick="disconnect()">æ–­å¼€è¿æ¥</button>
                <button onclick="clearMessages()">æ¸…ç©ºæ¶ˆæ¯</button>
            </div>
        </div>

        <div>
            <input type="text" id="messageInput" placeholder="è¾“å…¥æ¶ˆæ¯..." style="width: 300px;">
            <button onclick="sendMessage()">å‘é€æ¶ˆæ¯</button>
        </div>
    </div>

    <script>
        let socket;
        let messagesDiv = document.getElementById('messages');
        let statusDiv = document.getElementById('status');
        let currentEndpoint = '';

        function log(message) {
            const timestamp = new Date().toLocaleTimeString();
            messagesDiv.innerHTML += '<p>[' + timestamp + '] ' + message + '</p>';
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }

        function updateStatus(status, connected) {
            statusDiv.textContent = 'çŠ¶æ€: ' + status;
            statusDiv.className = 'status ' + (connected ? 'connected' : 'disconnected');
        }

        function connect(endpoint, label) {
            if (socket && socket.readyState === WebSocket.OPEN) {
                log('å·²ç»è¿æ¥åˆ° ' + currentEndpoint + 'ï¼Œè¯·å…ˆæ–­å¼€è¿æ¥ï¼');
                return;
            }

            try {
                currentEndpoint = label;
                updateStatus('æ­£åœ¨è¿æ¥åˆ° ' + label + '...', false);
                log('å°è¯•è¿æ¥åˆ°: ' + endpoint);

                socket = new WebSocket('ws://localhost:8080' + endpoint);

                socket.onopen = function (event) {
                    updateStatus('å·²è¿æ¥åˆ° ' + label, true);
                    log('âœ… è¿æ¥æˆåŠŸå»ºç«‹åˆ° ' + label);
                };

                socket.onmessage = function (event) {
                    log('ğŸ“¨ æ”¶åˆ°æ¶ˆæ¯: ' + event.data);
                };

                socket.onclose = function (event) {
                    updateStatus('è¿æ¥å·²å…³é—­', false);
                    log('âŒ è¿æ¥å·²å…³é—­ - Code: ' + event.code + ', Reason: ' + (event.reason || 'æ— åŸå› '));
                    currentEndpoint = '';
                };

                socket.onerror = function (error) {
                    updateStatus('è¿æ¥é”™è¯¯', false);
                    log('âŒ è¿æ¥é”™è¯¯: ' + (error.message || 'æœªçŸ¥é”™è¯¯'));
                    console.error('WebSocket error:', error);
                };
            } catch (error) {
                updateStatus('è¿æ¥å¤±è´¥', false);
                log('âŒ è¿æ¥å¼‚å¸¸: ' + error.message);
                console.error('Connection error:', error);
            }
        }

        function connectJSR356() {
            connect('/ws/echo', 'JSR356ç«¯ç‚¹');
        }

        function connectSpring() {
            connect('/ws/spring-echo', 'Springç«¯ç‚¹');
        }

        function connectFallback() {
            connect('/ws/fallback', 'å¤‡ç”¨ç«¯ç‚¹');
        }

        function disconnect() {
            if (socket) {
                socket.close();
                updateStatus('æ­£åœ¨æ–­å¼€è¿æ¥...', false);
                log('ğŸ”Œ æ‰‹åŠ¨æ–­å¼€è¿æ¥');
            } else {
                log('æ²¡æœ‰æ´»åŠ¨è¿æ¥');
            }
        }

        function sendMessage() {
            let message = document.getElementById('messageInput').value.trim();
            if (!message) {
                log('âš ï¸ æ¶ˆæ¯ä¸èƒ½ä¸ºç©º');
                return;
            }

            if (socket && socket.readyState === WebSocket.OPEN) {
                socket.send(message);
                log('ğŸ“¤ å·²å‘é€: ' + message);
                document.getElementById('messageInput').value = '';
            } else {
                log('âš ï¸ æ²¡æœ‰è¿æ¥ï¼Œè¯·å…ˆè¿æ¥åˆ°ä¸€ä¸ªç«¯ç‚¹');
            }
        }

        function clearMessages() {
            messagesDiv.innerHTML = '';
            log('æ¶ˆæ¯å·²æ¸…ç©º');
        }

        // å…è®¸æŒ‰Enteré”®å‘é€æ¶ˆæ¯
        document.getElementById('messageInput').addEventListener('keypress', function (e) {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });

        // é¡µé¢åŠ è½½å®Œæˆåæ˜¾ç¤ºåˆå§‹ä¿¡æ¯
        window.onload = function () {
            log('ğŸš€ WebSocketæµ‹è¯•é¡µé¢å·²åŠ è½½');
            log('ğŸ’¡ è¯·é€‰æ‹©ä¸€ä¸ªç«¯ç‚¹è¿›è¡Œè¿æ¥æµ‹è¯•');
        };
    </script>
</body>

</html>