## **“学伴”校园互助与资源共享平台 \- 软件设计规格说明书**

### **1\. 引言**

#### **1.1 目的**

本文档旨在详细描述“学伴”校园互助与资源共享平台（以下简称“平台”）的系统架构、模块设计、接口设计、数据库设计以及关键技术选型和设计决策。本文档是软件需求规格说明书（SRS）的延伸，将作为开发团队进行系统编码、集成和后续维护的主要技术依据，确保项目按照既定规范高效、高质量地完成。

#### **1.2 项目范围**

本设计规格说明书覆盖了“学伴”平台从用户交互界面到后端服务逻辑，再到数据存储的全部核心环节。具体包括：

* **前端设计原则与主要视图组件划分。**  
* **后端应用服务的整体架构、核心模块划分、关键业务流程设计。**  
* **数据库的详细表结构设计、关系设计及索引策略。**  
* **系统部署方案的初步构想。**  
* 安全性、可维护性和可扩展性等非功能性方面的设计考虑。  
  详细设计将包括核心功能模块的实现思路（通过类图、序列图等UML图表展示）、关键组件的交互方式。

#### **1.3 定义、首字母缩写词和缩略语**

* **SDS**: Software Design Specification (软件设计规格说明书)  
* **SRS**: Software Requirements Specification (软件需求规格说明书)  
* **UML**: Unified Modeling Language (统一建模语言)  
* **ERD**: Entity-Relationship Diagram (实体关系图)  
* **API**: Application Programming Interface (应用程序编程接口)  
* **JWT**: JSON Web Token (用于身份认证的开放标准)  
* **MVC**: Model-View-Controller (模型-视图-控制器架构模式)  
* **SPA**: Single Page Application (单页面应用)  
* **REST**: Representational State Transfer (表述性状态传递，一种Web服务架构风格)  
* **CRUD**: Create, Read, Update, Delete (创建、读取、更新、删除基本数据库操作)  
* **IDE**: Integrated Development Environment (集成开发环境)  
* **DB**: DataBase (数据库)  
* (其他在SRS中已定义的术语在此不再赘述)

#### **1.4 参考文献**

* 《“学伴”校园互助与资源共享平台-软件需求规格说明书》(ID: srs\_campus\_buddy\_platform)  
* 《软件工程：实践者的研究方法》（Software Engineering: A Practitioner's Approach by Roger S. Pressman）  
* 《企业应用架构模式》（Patterns of Enterprise Application Architecture by Martin Fowler）  
* 《Spring Boot编程思想》  
* 《深入浅出Vue.js》  
* Vue.js 官方文档 (vuejs.org)  
* Spring Framework 官方文档 (spring.io)  
* ElementPlus 官方文档 (element-plus.org)  
* MyBatisPlus 官方文档 (baomidou.com)

#### **1.5 文档概述**

本文档的组织结构如下：

* **第1章 引言**: 介绍文档目的、范围、定义、参考文献和概述。  
* **第2章 系统概述**: 回顾系统目标、阐述设计原则和技术选型。  
* **第3章 系统架构设计**: 描述平台的总体架构和前后端通信机制。  
* **第4章 UML图表与详细设计**: 核心章节，包含用例图、类图、包图、组件图、部署图和关键流程的序列图，并附带详细文字说明。  
* **第5章 前端设计概要**: 阐述前端视图组件、状态管理和路由设计。  
* **第6章 后端详细设计**: 描述后端各层（Controller, Service, Mapper）的设计要点及DTO/VO设计。  
* **第7章 数据库设计**: 提供详细的表结构设计和索引策略。  
* **第8章 安全性设计**: 讨论系统在认证、授权、数据保护等方面的安全措施。  
* **第9章 可维护性与可扩展性**: 阐述为保证系统易于维护和未来扩展所做的设计考虑。  
* **第10章 总结**: 对整个设计文档进行总结。

### **2\. 系统概述**

#### **2.1 系统目标回顾**

平台的核心目标是构建一个服务于在校学生的综合性互助与资源共享网络社区。通过该平台，学生可以：

* 便捷地发布和查找各类互助信息（如课程辅导、技能交换、物品借用）。  
* 创建或加入学习小组，进行协作学习和知识共享。  
* 分享或获取学习资料、二手物品等校园资源。  
* 通过信用评价体系建立互信的社区环境。  
  最终目标是提升校园内的信息流通效率，促进学生间的互助合作，丰富校园生活。

#### **2.2 设计原则**

为确保系统质量，设计过程遵循以下核心原则：

* **高内聚、低耦合 (High Cohesion, Low Coupling)**: 各模块内部功能紧密相关，模块之间依赖性降至最低，便于独立开发、测试和维护。  
* **前后端分离 (Frontend-Backend Separation)**: 前端专注于用户界面和交互逻辑，后端专注于业务处理和数据服务，通过清晰的API接口进行通信，提高开发效率和灵活性。  
* **面向接口编程 (Interface-Oriented Programming)**: Service层等关键组件优先定义接口，再进行实现，有利于解耦和单元测试。  
* **可扩展性 (Scalability)**: 系统架构和模块设计应考虑未来的功能扩展和用户量增长，易于添加新功能或提升系统性能。  
* **安全性 (Security)**: 从设计阶段就充分考虑数据安全和操作安全，防范常见的Web攻击。  
* **用户友好性 (User-Friendliness)**: 界面设计力求简洁直观，操作流程符合用户习惯，提供良好的用户体验。  
* **健壮性 (Robustness)**: 系统应能妥善处理各种异常情况，避免因意外输入或错误操作导致崩溃。  
* **可维护性 (Maintainability)**: 代码结构清晰，注释充分，遵循编码规范，便于后续的修改和升级。

#### **2.3 技术选型回顾**

* **前端**:  
  * 框架: Vue 3.0 (采用Composition API以获得更好的代码组织和复用)  
  * UI库: ElementPlus (提供丰富的桌面端UI组件)  
  * 路由: Vue Router (官方路由管理器)  
  * 状态管理: Pinia (轻量级、类型安全的状态管理库，Vue 3推荐)  
  * 构建工具: Vite (提供极速的冷启动和热模块替换HMR)  
  * HTTP客户端: Axios (用于与后端API通信)  
* **后端**:  
  * 框架: Spring Boot 3.0 (快速构建生产级应用)  
  * Web层: Spring Web MVC (实现RESTful API)  
  * 持久层: MyBatisPlus (MyBatis的增强工具，简化CRUD操作)  
  * 安全框架: Spring Security (处理认证和授权)  
  * 数据库连接池: HikariCP (Spring Boot默认，高性能)  
* **数据库**: MySQL 8.0+ (广泛使用的关系型数据库)  
* **缓存**: Redis (高性能键值存储，用于Session共享、热点数据缓存、验证码等)  
* **API文档**: SpringDoc OpenAPI (基于Swagger/OpenAPI 3.0规范，自动生成API文档)  
* **构建工具**: Maven (项目管理和构建工具)  
* **服务器**: Nginx (高性能Web服务器，用于反向代理和静态资源服务)  
* **开发语言**: 前端 (JavaScript/TypeScript)，后端 (Java 17+)

### **3\. 系统架构设计**

#### **3.1 总体架构**

本平台采用经典的分层架构与前后端分离的设计模式。逻辑上可分为表现层、应用层和数据层。  
graph TD  
    User\[\<img src='https://img.icons8.com/ios-filled/50/000000/user.png' style='width:30px;height:30px;' alt='用户'\> 用户\] \--\> Browser\[\<img src='https://img.icons8.com/color/48/chrome.png' style='width:30px;height:30px;' alt='浏览器'\> 浏览器 (Vue.js 应用)\]  
    Browser \-- HTTP/HTTPS \--\> Nginx\[\<img src='https://img.icons8.com/color/48/nginx.png' style='width:30px;height:30px;' alt='Nginx'\> Nginx \<br\>(反向代理/静态资源)\]  
    Nginx \-- API请求 \--\> APIGateway\[\<img src='https://img.icons8.com/fluency/48/gateway.png' style='width:30px;height:30px;' alt='API网关'\> API网关 (可选, 如Spring Cloud Gateway)\]  
    APIGateway \--\> Backend\_Services\[\<img src='https://img.icons8.com/color/48/spring-logo.png' style='width:30px;height:30px;' alt='后端服务'\> 后端应用服务 (Spring Boot)\]  
    Backend\_Services \-- JDBC \--\> MySQL\[\<img src='https://img.icons8.com/color/48/mysql-logo.png' style='width:30px;height:30px;' alt='MySQL'\> MySQL数据库\]  
    Backend\_Services \-- Redis Client \--\> Redis\[\<img src='https://img.icons8.com/color/48/redis.png' style='width:30px;height:30px;' alt='Redis'\> Redis缓存\]

    subgraph "客户端 (Client Tier)"  
        User  
        Browser  
    end

    subgraph "Web/代理层 (Web/Proxy Tier)"  
        Nginx  
    end  
      
    subgraph "应用服务层 (Application Service Tier)"  
        APIGateway  
        Backend\_Services  
    end

    subgraph "数据存储层 (Data Persistence Tier)"  
        MySQL  
        Redis  
    end

    style User fill:\#e6e6fa,stroke:\#333,stroke-width:2px  
    style Browser fill:\#add8e6,stroke:\#333,stroke-width:2px  
    style Nginx fill:\#90ee90,stroke:\#333,stroke-width:2px  
    style APIGateway fill:\#ffb6c1,stroke:\#333,stroke-width:2px  
    style Backend\_Services fill:\#cornflowerblue,stroke:\#333,stroke-width:2px  
    style MySQL fill:\#f4a460,stroke:\#333,stroke-width:2px  
    style Redis fill:\#ff6347,stroke:\#333,stroke-width:2px

* **表现层 (Frontend/Client Tier)**: 用户直接交互的界面，基于Vue.js构建的SPA，运行在用户的浏览器中。负责视图渲染、用户输入捕获、基本的前端校验以及通过API与后端通信。  
* **Web/代理层 (Web/Proxy Tier)**: 通常由Nginx担任。职责包括：  
  * 托管和提供前端静态资源（HTML, CSS, JavaScript文件）。  
  * 作为反向代理，将API请求转发到后端应用服务。  
  * 处理HTTPS加密/解密 (SSL Termination)。  
  * 实现负载均衡（当后端服务有多个实例时）。  
  * 可配置请求限流、IP黑白名单等。  
* **API网关层 (API Gateway Tier \- 可选)**: 对于复杂系统，可以引入API网关（如Spring Cloud Gateway）。职责包括：  
  * 统一的API入口，路由请求到具体的后端微服务（如果未来演进）。  
  * 聚合API响应。  
  * 实现认证、授权、限流、熔断、日志等横切关注点。  
  * 对于本项目的初期单体应用，API网关是可选的，Nginx可以承担部分网关功能。  
* **应用服务层 (Backend/Application Service Tier)**: 核心业务逻辑处理层，基于Spring Boot构建。  
  * 提供RESTful API接口供前端或其他客户端调用。  
  * 执行业务规则、数据校验、事务管理。  
  * 通过数据访问层与数据库和缓存进行交互。  
* **数据存储层 (Data Persistence Tier)**:  
  * **MySQL数据库**: 持久化存储核心业务数据。  
  * **Redis缓存**: 存储热点数据、会话信息、验证码、分布式锁等，以提高系统性能和响应速度。

#### **3.2 前后端通信**

* **通信协议**: 主要使用HTTP/HTTPS协议。  
* **数据格式**: 前后端数据交换统一采用JSON格式。  
* **API风格**: 后端API遵循RESTful设计原则，使用标准的HTTP方法 (GET, POST, PUT, DELETE等) 对应CRUD操作。  
* **身份认证**: 采用基于JWT (JSON Web Tokens) 的无状态认证机制。  
  1. 用户登录成功后，后端生成一个JWT并返回给前端。  
  2. 前端将JWT存储起来（如localStorage或Pinia store）。  
  3. 后续的API请求，前端需在HTTP请求头 (通常是 Authorization 头部，值为 Bearer \<token\>) 中携带此JWT。  
  4. 后端通过Spring Security配置的过滤器拦截请求，校验JWT的有效性（签名、过期时间等），通过则允许访问受保护资源。  
* **统一响应格式**: 后端API返回统一的JSON结构，例如：  
  {  
    "code": 200, // 业务状态码，如200成功，401未授权，500服务器错误  
    "message": "操作成功", // 提示信息  
    "data": { ... } // 实际业务数据，可以为对象或数组，或null  
  }

### **4\. UML图表与详细设计**

#### **4.1 用例图 (Use Case Diagram)**

用例图从用户角度描述了系统的功能需求，展示了不同类型的用户（参与者）如何与系统交互以完成特定任务。  
**主要参与者 (Actors):**

* **普通用户 (StudentUser)**: 平台的核心用户，可以使用大部分功能。  
* **管理员 (Administrator)**: (可选，为简化初期开发可暂不实现或实现部分功能) 负责系统维护、内容审核、用户管理等。

graph LR  
    subgraph "学伴平台用例"  
        actor StudentUser as "\<img src='https://img.icons8.com/ios-glyphs/30/user-male-circle.png' alt='普通用户'\>\<br\>普通用户"  
        actor Administrator as "\<img src='https://img.icons8.com/ios-glyphs/30/admin-settings-male.png' alt='管理员'\>\<br\>管理员 (可选)"

        StudentUser \--|\> UserBase \["\<img src='https://img.icons8.com/ios-glyphs/30/generic-sorting.png' alt='用户基础操作'\>\<br\>用户基础操作"\]  
        Administrator \--|\> UserBase

        package "用户账户管理" {  
            UserBase \-- (UC01: 注册账户)  
            UserBase \-- (UC02: 用户登录)  
            UserBase \-- (UC03: 查看个人资料)  
            UserBase \-- (UC04: 编辑个人资料)  
            UserBase \-- (UC05: 修改密码)  
            UserBase \-- (UC06: 找回密码)  
            UserBase \-- (UC07: 用户登出)  
        }

        package "互助信息模块" {  
            StudentUser \-- (UC10: 发布互助信息)  
            StudentUser \-- (UC11: 浏览/搜索互助信息)  
            StudentUser \-- (UC12: 查看互助信息详情)  
            StudentUser \-- (UC13: 申请/响应互助)  
            StudentUser \-- (UC14: 管理已发布信息)  
            StudentUser \-- (UC15: 确认互助完成)  
            StudentUser \-- (UC16: 评价互助方)  
        }

        package "学习小组模块" {  
            StudentUser \-- (UC20: 创建学习小组)  
            StudentUser \-- (UC21: 浏览/搜索学习小组)  
            StudentUser \-- (UC22: 查看小组详情)  
            StudentUser \-- (UC23: 申请加入/直接加入小组)  
            StudentUser \-- (UC24: 退出学习小组)  
            StudentUser \-- (UC25: 小组内发帖/评论)  
            StudentUser \-- (UC26: 小组文件共享)  
            StudentUser \-- (UC27: 管理小组成员\<br\>\<\<extends UC23, UC24\>\> \<br\>\<\<actor specific for group admin\>\>)  
        }

        package "资源共享模块" {  
            StudentUser \-- (UC30: 发布共享资源)  
            StudentUser \-- (UC31: 浏览/搜索共享资源)  
            StudentUser \-- (UC32: 获取共享资源)  
        }  
          
        package "通知模块" {  
            StudentUser \-- (UC40: 查看消息通知)  
        }

        package "后台管理 (管理员专属)" {  
            Administrator \-- (UC50: 用户账户管理)  
            Administrator \-- (UC51: 内容审核与管理)  
            Administrator \-- (UC52: 系统参数配置)  
            Administrator \-- (UC53: 查看数据统计)  
        }  
    end  
      
    style StudentUser fill:\#87CEEB,stroke:\#333,stroke-width:1.5px  
    style Administrator fill:\#90EE90,stroke:\#333,stroke-width:1.5px

文字说明:  
上图清晰地展示了“普通用户”和“管理员”两类参与者与系统各项功能的交互关系。

* **普通用户** 的核心用例覆盖了账户管理（注册、登录、修改资料等）、互助信息（发布、浏览、申请、评价等）、学习小组（创建、加入、讨论、共享文件等）、资源共享（发布、浏览等）以及查看通知。  
* **管理员** （如果实现）则负责后台管理功能，如用户管理、内容审核等。  
* UC27: 管理小组成员 是一个特殊的用例，它由学习小组的管理员（也是普通用户的一种角色）执行，并且扩展了加入和退出小组的场景。  
* 每个用例都应对应SRS中的一项或多项功能需求。

#### **4.2 类图 (Class Diagram / Domain Model)**

类图用于描述系统中的核心实体类、它们的属性、操作以及类之间的静态关系（如关联、聚合、继承、实现）。这是数据库设计和后端代码实现的重要基础。  
classDiagram  
    direction LR

    class User {  
        \<\<Entity\>\>  
        \+Long userId  
        \+String username  // 学号或邮箱, 唯一, 登录凭证  
        \+String passwordHash // BCrypt加密后的密码  
        \+String nickname  
        \+String avatarUrl // 头像图片链接  
        \+Gender gender // 枚举: MALE, FEMALE, UNKNOWN  
        \+String major // 专业  
        \+String grade // 年级  
        \+String contactInfo // 联系方式 (如QQ, 微信, 电话，用户可选是否公开)  
        \+List\~String\~ skillTags // 技能标签 (JSON字符串或特定格式存储)  
        \+Integer creditScore // 信用分, 初始值100  
        \+UserStatus status // 枚举: ACTIVE, INACTIVE, BANNED  
        \+Date createdAt  
        \+Date updatedAt  
        \--  
        \+register(RegisterDTO): User  
        \+login(LoginDTO): String (JWT)  
        \+updateProfile(ProfileDTO): User  
        \+changePassword(ChangePasswordDTO): void  
        \+viewProfile(Long userId): UserProfileVO  
    }

    class HelpInfo {  
        \<\<Entity\>\>  
        \+Long infoId  
        \+Long publisherId // FK to User.userId  
        \+HelpType type // 枚举: COURSE\_TUTORING, SKILL\_LEARNING, ITEM\_LEND, ITEM\_EXCHANGE, TEAM\_UP  
        \+String title  
        \+String description // HTML或Markdown格式  
        \+String expectedTime // 期望时间描述  
        \+String expectedLocation // 期望地点描述  
        \+String contactMethod // 建议联系方式  
        \+BigDecimal rewardAmount // 可选悬赏金额  
        \+List\~String\~ imageUrls // 图片链接列表 (JSON字符串)  
        \+InfoStatus status // 枚举: OPEN, IN\_PROGRESS, RESOLVED, EXPIRED, CLOSED  
        \+Integer viewCount // 浏览次数  
        \+Date createdAt  
        \+Date updatedAt  
        \--  
        \+publish(HelpInfoDTO): HelpInfo  
        \+edit(HelpInfoDTO): HelpInfo  
        \+markAsResolved(): void  
        \+closeInfo(): void  
    }

    class HelpApplication {  
        \<\<Entity\>\>  
        \+Long applicationId  
        \+Long infoId // FK to HelpInfo.infoId  
        \+Long applicantId // FK to User.userId (申请者)  
        \+Long publisherId // FK to User.userId (信息发布者，冗余方便查询)  
        \+String message // 申请附言  
        \+ApplicationStatus status // 枚举: PENDING, ACCEPTED, REJECTED, CANCELED  
        \+Date createdAt  
        \+Date updatedAt  
        \--  
        \+apply(ApplyDTO): HelpApplication  
        \+accept(): void  
        \+reject(): void  
        \+cancel(): void  
    }

    class StudyGroup {  
        \<\<Entity\>\>  
        \+Long groupId  
        \+Long creatorId // FK to User.userId  
        \+String groupName  
        \+String description  
        \+String avatarUrl  
        \+JoinType joinType // 枚举: PUBLIC (公开加入), APPROVAL\_NEEDED (申请加入)  
        \+GroupStatus groupStatus // 枚举: ACTIVE, DISBANDED  
        \+Integer memberCount // 成员数量，冗余字段  
        \+Date createdAt  
        \+Date updatedAt  
        \--  
        \+createGroup(GroupDTO): StudyGroup  
        \+updateGroupInfo(GroupDTO): StudyGroup  
        \+disbandGroup(): void  
    }

    class GroupMember {  
        \<\<LinkTable / Entity\>\>  
        \+Long id // 自增主键  
        \+Long groupId // FK to StudyGroup.groupId  
        \+Long userId // FK to User.userId  
        \+MemberRole role // 枚举: MEMBER, ADMIN, CREATOR  
        \+GroupMemberStatus status // 枚举: ACTIVE, PENDING\_APPROVAL, BANNED  
        \+Date joinedAt  
        \--  
        \+approveJoin(): void  
        \+setRole(MemberRole newRole): void  
    }

    class GroupPost {  
        \<\<Entity\>\>  
        \+Long postId  
        \+Long groupId // FK to StudyGroup.groupId  
        \+Long authorId // FK to User.userId  
        \+String title  
        \+String content // HTML或Markdown格式  
        \+Boolean isPinned // 是否置顶  
        \+Integer commentCount // 评论数，冗余  
        \+Date createdAt  
        \+Date updatedAt  
    }  
      
    class PostComment {  
        \<\<Entity\>\>  
        \+Long commentId  
        \+Long postId // FK to GroupPost.postId  
        \+Long authorId // FK to User.userId  
        \+String content  
        \+Long parentCommentId // FK to PostComment.commentId (用于实现二级评论)  
        \+Date createdAt  
    }

    class SharedResource {  
        \<\<Entity\>\>  
        \+Long resourceId  
        \+Long uploaderId // FK to User.userId  
        \+Long groupId // Optional FK to StudyGroup.groupId (如果资源属于特定小组)  
        \+ResourceType type // 枚举: BOOK, E\_DOCUMENT, SOFTWARE, OTHER\_ITEM  
        \+String resourceName  
        \+String description  
        \+String filePathOrLink // 文件存储路径或外部链接  
        \+List\~String\~ imageUrls  
        \+ResourceStatus resourceStatus // 枚举: AVAILABLE, BORROWED, UNAVAILABLE  
        \+Date createdAt  
        \+Date updatedAt  
    }

    class Review {  
        \<\<Entity\>\>  
        \+Long reviewId  
        \+Long reviewedUserId // 被评价用户ID (FK to User.userId)  
        \+Long reviewerUserId // 评价用户ID (FK to User.userId)  
        \+Long relatedInfoId // 关联的互助信息ID (FK to HelpInfo.infoId)  
        \+Integer rating // 1-5星  
        \+String comment  
        \+Date createdAt  
    }

    class Notification {  
        \<\<Entity\>\>  
        \+Long notificationId  
        \+Long recipientId // FK to User.userId (接收者)  
        \+NotificationType type // 枚举: SYSTEM, HELP\_REQUEST\_NEW, HELP\_APP\_ACCEPTED, ...  
        \+String title  
        \+String content  
        \+String relatedUrl // 点击通知后跳转的链接  
        \+Boolean isRead  
        \+Date createdAt  
    }

    User "1" \-- "0..\*" HelpInfo : (publisherId) publishes  
    User "1" \-- "0..\*" HelpApplication : (applicantId) applies for  
    HelpInfo "1" \-- "0..\*" HelpApplication : (infoId) has  
    User "1" \-- "0..\*" StudyGroup : (creatorId) creates  
      
    StudyGroup "1" \-- "1..\*" GroupMember : (groupId) has members  
    User "1" \-- "0..\*" GroupMember : (userId) is member of  
      
    StudyGroup "1" \-- "0..\*" GroupPost : (groupId) contains  
    User "1" \-- "0..\*" GroupPost : (authorId) posts  
    GroupPost "1" \-- "0..\*" PostComment : (postId) has  
    User "1" \-- "0..\*" PostComment : (authorId) comments on  
      
    User "1" \-- "0..\*" SharedResource : (uploaderId) uploads  
    StudyGroup "0..1" \-- "0..\*" SharedResource : (groupId) shares within group  
      
    User "1" \-- "0..\*" Review : (reviewerUserId) gives review to  
    User "1" \-- "0..\*" Review : (reviewedUserId) receives review from  
    HelpInfo "1" \-- "0..2" Review : (relatedInfoId) is reviewed for  
      
    User "1" \-- "0..\*" Notification : (recipientId) receives

    enum Gender { MALE, FEMALE, UNKNOWN }  
    enum UserStatus { ACTIVE, INACTIVE, BANNED }  
    enum HelpType { COURSE\_TUTORING, SKILL\_LEARNING, ITEM\_LEND, ITEM\_EXCHANGE, TEAM\_UP }  
    enum InfoStatus { OPEN, IN\_PROGRESS, RESOLVED, EXPIRED, CLOSED }  
    enum ApplicationStatus { PENDING, ACCEPTED, REJECTED, CANCELED }  
    enum JoinType { PUBLIC, APPROVAL\_NEEDED }  
    enum GroupStatus { ACTIVE, DISBANDED }  
    enum MemberRole { MEMBER, ADMIN, CREATOR }  
    enum GroupMemberStatus { ACTIVE, PENDING\_APPROVAL, BANNED }  
    enum ResourceType { BOOK, E\_DOCUMENT, SOFTWARE, OTHER\_ITEM }  
    enum ResourceStatus { AVAILABLE, BORROWED, UNAVAILABLE }  
    enum NotificationType { SYSTEM, HELP\_REQUEST\_NEW, HELP\_APP\_ACCEPTED, GROUP\_INVITE\_NEW, GROUP\_APP\_APPROVED, NEW\_POST\_IN\_GROUP, NEW\_COMMENT, REVIEW\_RECEIVED }

    User .. Gender  
    User .. UserStatus  
    HelpInfo .. HelpType  
    HelpInfo .. InfoStatus  
    HelpApplication .. ApplicationStatus  
    StudyGroup .. JoinType  
    StudyGroup .. GroupStatus  
    GroupMember .. MemberRole  
    GroupMember .. GroupMemberStatus  
    SharedResource .. ResourceType  
    SharedResource .. ResourceStatus  
    Notification .. NotificationType

文字说明:  
上图展示了系统的核心领域模型：

* **User**: 平台用户实体，包含登录认证信息、基本资料、技能标签、信用分及状态。定义了注册、登录、更新资料等基本操作。  
* **HelpInfo**: 互助信息实体，包含发布者、类型、标题、描述、状态、悬赏等。  
* **HelpApplication**: 用户对互助信息的申请记录。  
* **StudyGroup**: 学习小组实体，包含创建者、小组名称、描述、加入方式、状态等。  
* **GroupMember**: 用户与学习小组的关联实体，记录成员角色和状态。  
* **GroupPost** 和 **PostComment**: 分别代表小组内的帖子和对帖子的评论。  
* **SharedResource**: 用户共享的资源实体，如书籍、文档等。  
* **Review**: 用户在互助完成后进行的相互评价记录。  
* **Notification**: 系统发送给用户的通知消息。  
* 图中明确了各实体间的关联关系（如一对多、多对多）和基数。例如，一个User可以发布多条HelpInfo，一条HelpInfo只属于一个User。  
* 定义了多个枚举类型（Enums）用于规范状态、类型等字段的取值，这对于后续代码实现和数据一致性非常重要。  
* 每个实体类都标注了\<\<Entity\>\>构造型，表示它们将映射到数据库表。  
* 方法部分初步定义了实体可能包含的核心业务操作，具体实现将在Service层。

#### **4.3 后端包图 (Package Diagram)**

包图用于组织后端代码的逻辑结构，展示模块化的设计思路和包之间的依赖关系。  
graph TD  
    subgraph com.campusbuddy \[学伴平台后端 (com.campusbuddy)\]  
        direction LR  
        subgraph controller \[controller (API接口层)\]  
            style controller fill:\#B0E0E6,stroke:\#00008B  
            UserCtrl\["UserController\<br\>\<img src='https://img.icons8.com/ios-filled/24/000000/controller.png' alt='controller icon'\>"\]  
            HelpInfoCtrl\["HelpInfoController\<br\>\<img src='https://img.icons8.com/ios-filled/24/000000/controller.png' alt='controller icon'\>"\]  
            StudyGroupCtrl\["StudyGroupController\<br\>\<img src='https://img.icons8.com/ios-filled/24/000000/controller.png' alt='controller icon'\>"\]  
            ResourceCtrl\["ResourceController\<br\>\<img src='https://img.icons8.com/ios-filled/24/000000/controller.png' alt='controller icon'\>"\]  
            ReviewCtrl\["ReviewController\<br\>\<img src='https://img.icons8.com/ios-filled/24/000000/controller.png' alt='controller icon'\>"\]  
            NotificationCtrl\["NotificationController\<br\>\<img src='https://img.icons8.com/ios-filled/24/000000/controller.png' alt='controller icon'\>"\]  
        end

        subgraph service \[service (业务逻辑层)\]  
            style service fill:\#98FB98,stroke:\#006400  
            direction LR  
            subgraph impl \[impl (业务实现)\]  
                style impl fill:\#E0FFFF,stroke:\#008080  
                UserServiceImpl\["UserServiceImpl\<br\>\<img src='https://img.icons8.com/ios-filled/24/000000/gears.png' alt='service impl icon'\>"\]  
                HelpInfoServiceImpl\["HelpInfoServiceImpl\<br\>\<img src='https://img.icons8.com/ios-filled/24/000000/gears.png' alt='service impl icon'\>"\]  
                StudyGroupServiceImpl\["StudyGroupServiceImpl\<br\>\<img src='https://img.icons8.com/ios-filled/24/000000/gears.png' alt='service impl icon'\>"\]  
                ResourceServiceImpl\["ResourceServiceImpl\<br\>\<img src='https://img.icons8.com/ios-filled/24/000000/gears.png' alt='service impl icon'\>"\]  
                ReviewServiceImpl\["ReviewServiceImpl\<br\>\<img src='https://img.icons8.com/ios-filled/24/000000/gears.png' alt='service impl icon'\>"\]  
                NotificationServiceImpl\["NotificationServiceImpl\<br\>\<img src='https://img.icons8.com/ios-filled/24/000000/gears.png' alt='service impl icon'\>"\]  
            end  
            UserService\["UserService (接口)\<br\>\<img src='https://img.icons8.com/ios/24/000000/interface.png' alt='interface icon'\>"\]  
            HelpInfoService\["HelpInfoService (接口)\<br\>\<img src='https://img.icons8.com/ios/24/000000/interface.png' alt='interface icon'\>"\]  
            StudyGroupService\["StudyGroupService (接口)\<br\>\<img src='https://img.icons8.com/ios/24/000000/interface.png' alt='interface icon'\>"\]  
            ResourceService\["ResourceService (接口)\<br\>\<img src='https://img.icons8.com/ios/24/000000/interface.png' alt='interface icon'\>"\]  
            ReviewService\["ReviewService (接口)\<br\>\<img src='https://img.icons8.com/ios/24/000000/interface.png' alt='interface icon'\>"\]  
            NotificationService\["NotificationService (接口)\<br\>\<img src='https://img.icons8.com/ios/24/000000/interface.png' alt='interface icon'\>"\]

            UserServiceImpl \-.-\> UserService  
            HelpInfoServiceImpl \-.-\> HelpInfoService  
            StudyGroupServiceImpl \-.-\> StudyGroupService  
            ResourceServiceImpl \-.-\> ResourceService  
            ReviewServiceImpl \-.-\> ReviewService  
            NotificationServiceImpl \-.-\> NotificationService  
        end

        subgraph mapper \[mapper (数据访问接口 \- MyBatisPlus)\]  
            style mapper fill:\#FFE4B5,stroke:\#8B4513  
            UserMapper\["UserMapper\<br\>\<img src='https://img.icons8.com/ios-filled/24/000000/database.png' alt='mapper icon'\>"\]  
            HelpInfoMapper\["HelpInfoMapper\<br\>\<img src='https://img.icons8.com/ios-filled/24/000000/database.png' alt='mapper icon'\>"\]  
            StudyGroupMapper\["StudyGroupMapper\<br\>\<img src='https://img.icons8.com/ios-filled/24/000000/database.png' alt='mapper icon'\>"\]  
            GroupMemberMapper\["GroupMemberMapper\<br\>\<img src='https://img.icons8.com/ios-filled/24/000000/database.png' alt='mapper icon'\>"\]  
            ResourceMapper\["ResourceMapper\<br\>\<img src='https://img.icons8.com/ios-filled/24/000000/database.png' alt='mapper icon'\>"\]  
            ReviewMapper\["ReviewMapper\<br\>\<img src='https://img.icons8.com/ios-filled/24/000000/database.png' alt='mapper icon'\>"\]  
            NotificationMapper\["NotificationMapper\<br\>\<img src='https://img.icons8.com/ios-filled/24/000000/database.png' alt='mapper icon'\>"\]  
        end

        subgraph entity \[entity (数据库实体类)\]  
            style entity fill:\#FFFACD,stroke:\#BDB76B  
            UserEntity\["User (对应User类图)\<br\>\<img src='https://img.icons8.com/ios-filled/24/000000/data-sheet.png' alt='entity icon'\>"\]  
            HelpInfoEntity\["HelpInfo (对应HelpInfo类图)\<br\>\<img src='https://img.icons8.com/ios-filled/24/000000/data-sheet.png' alt='entity icon'\>"\]  
            % ... 其他实体类  
        end

        subgraph dto \[dto (数据传输对象)\]  
            style dto fill:\#E6E6FA,stroke:\#483D8B  
            UserDTOs\["UserDTOs (RegisterDTO, LoginDTO, ProfileDTO)\<br\>\<img src='https://img.icons8.com/ios-filled/24/000000/data-transfer.png' alt='dto icon'\>"\]  
            HelpInfoDTOs\["HelpInfoDTOs (HelpInfoPublishDTO, HelpInfoUpdateDTO)\<br\>\<img src='https://img.icons8.com/ios-filled/24/000000/data-transfer.png' alt='dto icon'\>"\]  
            % ... 其他DTO  
        end  
          
        subgraph vo \[vo (视图对象)\]  
            style vo fill:\#FAFAD2,stroke:\#6B8E23  
            UserVOs\["UserVOs (UserProfileVO, UserSimpleVO)\<br\>\<img src='https://img.icons8.com/ios-filled/24/000000/visible.png' alt='vo icon'\>"\]  
            HelpInfoVOs\["HelpInfoVOs (HelpInfoDetailVO, HelpInfoListVO)\<br\>\<img src='https://img.icons8.com/ios-filled/24/000000/visible.png' alt='vo icon'\>"\]  
            % ... 其他VO  
        end

        subgraph config \[config (配置类)\]  
            style config fill:\#D3D3D3,stroke:\#696969  
            SecurityConfig\["SecurityConfig\<br\>\<img src='https://img.icons8.com/ios-filled/24/000000/settings.png' alt='config icon'\>"\]  
            MyBatisPlusConfig\["MyBatisPlusConfig\<br\>\<img src='https://img.icons8.com/ios-filled/24/000000/settings.png' alt='config icon'\>"\]  
            RedisConfig\["RedisConfig\<br\>\<img src='https://img.icons8.com/ios-filled/24/000000/settings.png' alt='config icon'\>"\]  
            WebMvcConfig\["WebMvcConfig (如跨域、拦截器)\<br\>\<img src='https://img.icons8.com/ios-filled/24/000000/settings.png' alt='config icon'\>"\]  
        end

        subgraph common \[common (通用工具与常量)\]  
            style common fill:\#F5F5F5,stroke:\#A9A9A9  
            Constants\["Constants (常量类)\<br\>\<img src='https://img.icons8.com/ios-filled/24/000000/T.png' alt='constants icon'\>"\]  
            Result\["R (统一返回结果类)\<br\>\<img src='https://img.icons8.com/ios-filled/24/000000/generic-text.png' alt='result icon'\>"\]  
            Enums\["Enums (所有枚举类)\<br\>\<img src='https://img.icons8.com/ios-filled/24/000000/list.png' alt='enums icon'\>"\]  
            Utils\["Utils (如JwtUtil, DateUtil, ValidationUtil)\<br\>\<img src='https://img.icons8.com/ios-filled/24/000000/maintenance.png' alt='utils icon'\>"\]  
        end  
          
        subgraph security \[security (Spring Security相关)\]  
            style security fill:\#FFDAB9,stroke:\#D2691E  
            JwtTokenProvider\["JwtTokenProvider\<br\>\<img src='https://img.icons8.com/ios-filled/24/000000/key.png' alt='jwt icon'\>"\]  
            UserDetailsServiceImpl\["UserDetailsServiceImpl\<br\>\<img src='https://img.icons8.com/ios-filled/24/000000/user-credentials.png' alt='user details icon'\>"\]  
            AuthEntryPointJwt\["AuthEntryPointJwt\<br\>\<img src='https://img.icons8.com/ios-filled/24/000000/door-key.png' alt='auth entry icon'\>"\]  
            AuthTokenFilter\["AuthTokenFilter (JWT校验过滤器)\<br\>\<img src='https://img.icons8.com/ios-filled/24/000000/filter.png' alt='filter icon'\>"\]  
        end  
          
        subgraph exception \[exception (全局异常处理)\]  
            style exception fill:\#FFC0CB,stroke:\#DB7093  
            GlobalExceptionHandler\["GlobalExceptionHandler\<br\>\<img src='https://img.icons8.com/ios-filled/24/000000/error.png' alt='exception icon'\>"\]  
            CustomException\["CustomException (自定义业务异常)\<br\>\<img src='https://img.icons8.com/ios-filled/24/000000/error.png' alt='exception icon'\>"\]  
        end

        controller \--\> service  
        service \--\> mapper  
        mapper \--\> entity  
        service \--\> dto  
        controller \--\> vo  
        controller \--\> common % R.java  
        service \--\> common % Enums, Utils  
        config \--\> common  
        security \--\> common % JwtUtil  
        security \--\> service % UserDetailsService uses UserService  
        exception \--\> common % R.java  
          
        service \--\> entity % Service may convert DTO to Entity  
        controller \--\> dto % Controller may receive DTOs  
    end

文字说明:  
后端代码将遵循典型的分层结构，组织在com.campusbuddy根包下：

* **controller**: API接口层。包含各类\*Controller，如UserController, HelpInfoController。它们接收前端HTTP请求，对参数进行初步校验，调用Service层处理业务逻辑，并将Service层返回的数据封装成统一的R对象（包含VO）返回给前端。  
* **service**: 业务逻辑核心层。包含业务接口（如UserService.java）及其实现类（如UserServiceImpl.java，通常放在service.impl子包）。负责复杂的业务规则处理、事务管理、调用Mapper层进行数据持久化，以及聚合不同Mapper的操作。  
* **mapper**: 数据访问接口层。包含各类\*Mapper接口（如UserMapper），继承自MyBatisPlus的BaseMapper\<Entity\>，用于直接与数据库交互，执行SQL语句。  
* **entity**: 数据库实体类包。包含与数据库表一一对应的Java POJO类，如User.java, HelpInfo.java。这些类通常使用JPA注解（如@Table, @Id, @Column）或MyBatisPlus注解（如@TableName, @TableId）来映射数据库表。  
* **dto (Data Transfer Object)**: 数据传输对象包。用于封装层与层之间（尤其是Controller层与Service层之间）传递的数据。例如，前端提交的注册信息可以封装成RegisterDTO。DTO不直接映射数据库表。  
* **vo (View Object)**: 视图对象包。用于Controller层向前端返回的数据。VO是根据前端展示需求定制的数据结构，可能包含多个Entity的部分字段或聚合信息。例如，HelpInfoDetailVO可能包含发布者昵称等关联信息。  
* **config**: 配置类包。包含Spring Boot的各项配置类，如SecurityConfig（Spring Security配置）、MyBatisPlusConfig、RedisConfig、WebMvcConfig（如配置跨域、拦截器、全局格式化等）。  
* **common**: 通用工具与常量包。  
  * constants: 存放系统常量。  
  * enums: 存放所有业务相关的枚举类型。  
  * utils: 存放通用工具类，如JwtUtil、日期处理工具、字符串工具等。  
  * vo或model: 可能包含统一的API响应结果类 R.java。  
* **security**: Spring Security相关组件包。包含JWT的生成与校验工具类 (JwtTokenProvider)、用户身份信息加载服务 (UserDetailsServiceImpl)、认证入口点 (AuthEntryPointJwt)、JWT请求过滤器 (AuthTokenFilter)等。  
* **exception**: 全局异常处理包。包含GlobalExceptionHandler（使用@ControllerAdvice捕获全局异常并统一处理返回）和自定义业务异常类（如ResourceNotFoundException）。

**依赖关系:**

* Controller 依赖 Service 和 DTO/VO。  
* Service 依赖 Mapper, Entity, DTO，也可能依赖其他Service。  
* Mapper 依赖 Entity。  
* 各层都可能依赖 Common 包中的工具类和枚举。  
* Security 包与 Service（获取用户信息）、Config（安全配置）等相关联。

#### **4.4 组件图 (Component Diagram)**

组件图展示了系统的主要物理组件（如可执行文件、库、配置文件）及其之间的依赖关系和接口。  
graph TD  
    subgraph "客户端 (Client Side)"  
        VueApp\["\<img src='https://img.icons8.com/color/48/vue-js.png' alt='Vue.js应用'\>\<br\>Vue.js SPA (静态资源: HTML, JS, CSS)"\]  
    end

    subgraph "服务器端 (Server Side)"  
        NginxServer\["\<img src='https://img.icons8.com/color/48/nginx.png' alt='Nginx'\>\<br\>Nginx Web服务器"\]  
        SpringBootAppJar\["\<img src='https://img.icons8.com/color/48/spring-logo.png' alt='Spring Boot应用'\>\<br\>CampusBuddy.jar (Spring Boot应用)"\]  
        MySQLDB\["\<img src='https://img.icons8.com/color/48/mysql-logo.png' alt='MySQL'\>\<br\>MySQL数据库服务"\]  
        RedisCache\["\<img src='https://img.icons8.com/color/48/redis.png' alt='Redis'\>\<br\>Redis缓存服务"\]  
          
        package "后端依赖库 (JARs within SpringBootAppJar)" {  
            SpringFrameworkLibs\["Spring Framework Libs\<br\>\<img src='https://img.icons8.com/ios-filled/24/java-jar-file.png' alt='jar icon'\>"\]  
            MyBatisPlusLib\["MyBatisPlus Lib\<br\>\<img src='https://img.icons8.com/ios-filled/24/java-jar-file.png' alt='jar icon'\>"\]  
            SpringSecurityLib\["Spring Security Lib\<br\>\<img src='https://img.icons8.com/ios-filled/24/java-jar-file.png' alt='jar icon'\>"\]  
            RedisClientLib\["Redis Client Lib\<br\>\<img src='https://img.icons8.com/ios-filled/24/java-jar-file.png' alt='jar icon'\>"\]  
            MySQLConnectorLib\["MySQL Connector/J\<br\>\<img src='https://img.icons8.com/ios-filled/24/java-jar-file.png' alt='jar icon'\>"\]  
        }  
    end  
      
    VueApp \-- "提供静态资源" \--\> NginxServer  
    NginxServer \-- "反向代理API请求 (HTTP/HTTPS)" \--\> SpringBootAppJar  
      
    SpringBootAppJar \-- "依赖" \--\> SpringFrameworkLibs  
    SpringBootAppJar \-- "依赖" \--\> MyBatisPlusLib  
    SpringBootAppJar \-- "依赖" \--\> SpringSecurityLib  
    SpringBootAppJar \-- "依赖" \--\> RedisClientLib  
    SpringBootAppJar \-- "依赖" \--\> MySQLConnectorLib

    MyBatisPlusLib \-- "使用" \--\> MySQLConnectorLib  
    SpringBootAppJar \-- "访问 (JDBC)" \--\> MySQLDB  
    SpringBootAppJar \-- "访问 (Redis Protocol)" \--\> RedisCache

    %% Component Stereotypes (using text)  
    VueApp:::componentArtifact  
    NginxServer:::componentExecutable  
    SpringBootAppJar:::componentExecutable  
    MySQLDB:::componentDatabase  
    RedisCache:::componentCache  
    SpringFrameworkLibs:::componentLibrary  
    MyBatisPlusLib:::componentLibrary  
    SpringSecurityLib:::componentLibrary  
    RedisClientLib:::componentLibrary  
    MySQLConnectorLib:::componentLibrary

    classDef componentArtifact fill:\#FFEBCD,stroke:\#A0522D,stroke-width:1.5px  
    classDef componentExecutable fill:\#ADD8E6,stroke:\#4682B4,stroke-width:1.5px  
    classDef componentDatabase fill:\#F0E68C,stroke:\#BDB76B,stroke-width:1.5px  
    classDef componentCache fill:\#FFB6C1,stroke:\#DB7093,stroke-width:1.5px  
    classDef componentLibrary fill:\#E0FFFF,stroke:\#008B8B,stroke-width:1.5px

**文字说明:**

* **Vue.js SPA (静态资源)**: 客户端组件，由HTML, CSS, JavaScript文件构成，通过Vite/Webpack打包生成。  
* **Nginx Web服务器**: 部署在服务器上，作为可执行组件，负责处理HTTP请求和静态资源服务。  
* **CampusBuddy.jar (Spring Boot应用)**: 后端核心业务逻辑组件，是一个可执行的JAR包，内嵌了Tomcat等Web容器。  
* **后端依赖库**: Spring Boot应用内部依赖的各种库文件（JARs），如Spring框架库、MyBatisPlus库、Spring Security库、Redis客户端库、MySQL驱动程序等。这些库提供了基础功能支持。  
* **MySQL数据库服务**: 独立运行的数据库服务组件。  
* **Redis缓存服务**: 独立运行的缓存服务组件。

**组件间接口与依赖:**

* Nginx为VueApp提供静态资源服务接口，并反向代理API请求到SpringBootAppJar。  
* SpringBootAppJar通过JDBC接口与MySQLDB交互，通过Redis客户端库与RedisCache交互。  
* SpringBootAppJar依赖其内部的各种库组件来提供功能。

#### **4.5 部署图 (Deployment Diagram)**

部署图描述了系统组件如何在物理或虚拟硬件节点上部署，以及节点间的网络连接。  
graph TD  
    subgraph "用户终端 (User Device)"  
        direction LR  
        ClientNode\["\<img src='https://img.icons8.com/ios/50/000000/laptop-metrics.png' alt='用户设备'\>\<br\>用户设备 (PC/Mobile)"\]  
        ClientNode \-- 运行 \--\> Browser\["\<img src='https://img.icons8.com/color/48/chrome.png' alt='浏览器'\>\<br\>浏览器"\]  
        Browser \-- 部署/加载 \--\> VueAppArtifact\["\<\<artifact\>\> Vue.js SPA\<br\>\<img src='https://img.icons8.com/color/48/vue-js.png' alt='Vue应用'\>"\]  
    end

    subgraph "应用服务器节点 (Application Server Node)"  
        direction TB  
        AppServerNode\["\<img src='https://img.icons8.com/ios/50/000000/server.png' alt='应用服务器'\>\<br\>应用服务器 (Linux VM/Container)"\]  
        AppServerNode \-- 运行 \--\> NginxProcess\["\<\<process\>\> Nginx\<br\>\<img src='https://img.icons8.com/color/48/nginx.png' alt='Nginx进程'\>"\]  
        AppServerNode \-- 运行 \--\> JVMProcess\["\<\<process\>\> JVM\<br\>\<img src='https://img.icons8.com/color/48/java-coffee-cup-logo.png' alt='JVM进程'\>"\]  
        JVMProcess \-- 部署/运行 \--\> SpringBootAppArtifact\["\<\<artifact\>\> CampusBuddy.jar\<br\>\<img src='https://img.icons8.com/color/48/spring-logo.png' alt='Spring Boot应用'\>"\]  
    end  
      
    subgraph "数据库服务器节点 (Database Server Node)"  
        direction TB  
        DBServerNode\["\<img src='https://img.icons8.com/ios/50/000000/database.png' alt='数据库服务器'\>\<br\>数据库服务器 (Linux VM/Cloud RDS)"\]  
        DBServerNode \-- 运行 \--\> MySQLProcess\["\<\<process\>\> MySQL Server\<br\>\<img src='https://img.icons8.com/color/48/mysql-logo.png' alt='MySQL服务'\>"\]  
    end

    subgraph "缓存服务器节点 (Cache Server Node)"  
        direction TB  
        CacheServerNode\["\<img src='https://img.icons8.com/ios/50/000000/caching.png' alt='缓存服务器'\>\<br\>缓存服务器 (Linux VM/Cloud Cache)"\]  
        CacheServerNode \-- 运行 \--\> RedisProcess\["\<\<process\>\> Redis Server\<br\>\<img src='https://img.icons8.com/color/48/redis.png' alt='Redis服务'\>"\]  
    end

    Browser \-- "HTTP/HTTPS (Internet/Intranet)" \--\> NginxProcess  
    NginxProcess \-- "HTTP (Local/Intranet)" \--\> SpringBootAppArtifact % More accurately, to the JVM process hosting it  
    SpringBootAppArtifact \-- "TCP/IP (JDBC)" \--\> MySQLProcess  
    SpringBootAppArtifact \-- "TCP/IP (Redis Protocol)" \--\> RedisProcess

    classDef node fill:\#B0C4DE,stroke:\#4682B4,stroke-width:2px,rx:5px,ry:5px  
    classDef artifact fill:\#FFF8DC,stroke:\#DAA520,stroke-width:1.5px,padding:5px  
    classDef process fill:\#90EE90,stroke:\#2E8B57,stroke-width:1.5px,padding:5px  
      
    class ClientNode node  
    class AppServerNode node  
    class DBServerNode node  
    class CacheServerNode node  
      
    class VueAppArtifact artifact  
    class SpringBootAppArtifact artifact  
      
    class Browser process  
    class NginxProcess process  
    class JVMProcess process  
    class MySQLProcess process  
    class RedisProcess process

**文字说明:**

* **用户终端节点**: 用户的个人电脑或移动设备，运行浏览器，浏览器加载并执行Vue.js前端应用（作为部署的artifact）。  
* **应用服务器节点**: 物理服务器、虚拟机或容器。  
  * 运行Nginx进程，负责接收外部请求和提供静态资源。  
  * 运行JVM进程，JVM内部署并运行Spring Boot应用 (CampusBuddy.jar artifact)。  
* **数据库服务器节点**: 专门用于运行MySQL数据库服务的节点。可以是独立的物理服务器、虚拟机，或云数据库服务（如AWS RDS, Aliyun RDS）。  
* **缓存服务器节点**: 专门用于运行Redis缓存服务的节点。类似数据库服务器，可以是独立服务器或云缓存服务。

**节点间通信:**

* 用户浏览器通过Internet或校园内网与应用服务器上的Nginx通过HTTP/HTTPS协议通信。  
* Nginx将API请求通过本地网络或内网HTTP转发给同一服务器或集群中其他服务器上的Spring Boot应用。  
* Spring Boot应用通过TCP/IP连接（使用JDBC协议）访问数据库服务器上的MySQL服务。  
* Spring Boot应用通过TCP/IP连接（使用Redis自定义协议）访问缓存服务器上的Redis服务。

*初期部署时，为了简化，应用服务器、数据库服务器和缓存服务器可以部署在同一台物理机或虚拟机上，但生产环境建议分离以获得更好的性能、可伸缩性和安全性。*

#### **4.6 序列图 (Sequence Diagrams for Key Use Cases)**

序列图按时间顺序展示了对象之间为完成特定用例场景而进行的交互。

##### **4.6.1 用例场景1: 用户成功注册**

sequenceDiagram  
    actor User as "用户"  
    participant Browser as "浏览器 (VueApp)"  
    participant UserCtrl as "UserController"  
    participant UserService as "UserService"  
    participant UserMapper as "UserMapper"  
    participant PasswordEncoder as "BCryptPasswordEncoder"  
    participant DB as "MySQL数据库"

    User-\>\>Browser: 1\. 填写注册表单 (用户名, 密码, 昵称等)  
    Browser-\>\>Browser: 2\. 前端校验表单数据  
    alt 前端校验失败  
        Browser-\>\>User: 2.1 显示错误提示  
    else 前端校验成功  
        Browser-\>\>UserCtrl: 3\. POST /api/users/register (RegisterDTO)  
        UserCtrl-\>\>UserService: 4\. register(registerDTO)  
        UserService-\>\>UserMapper: 5\. findByUsername(username)  
        UserMapper-\>\>DB: 6\. SELECT \* FROM user WHERE username \= ?  
        DB--\>\>UserMapper: 7\. 返回查询结果 (null 或 UserEntity)  
        alt 用户名已存在  
            UserMapper--\>\>UserService: 8.1 UserEntity  
            UserService--\>\>UserCtrl: 8.2 抛出 UsernameExistsException  
            UserCtrl--\>\>Browser: 8.3 HTTP 409 Conflict (用户名已存在)  
            Browser-\>\>User: 8.4 显示错误提示  
        else 用户名可用  
            UserMapper--\>\>UserService: 9.1 null  
            UserService-\>\>PasswordEncoder: 9.2 encode(rawPassword)  
            PasswordEncoder--\>\>UserService: 9.3 返回 hashedPassword  
            UserService-\>\>UserMapper: 9.4 insert(userEntity with hashedPassword)  
            UserMapper-\>\>DB: 9.5 INSERT INTO user (...) VALUES (...)  
            DB--\>\>UserMapper: 9.6 插入成功 (返回生成ID的UserEntity)  
            UserMapper--\>\>UserService: 9.7 返回 UserEntity  
            UserService--\>\>UserCtrl: 9.8 返回 UserVO (不含密码)  
            UserCtrl--\>\>Browser: 9.9 HTTP 201 Created (UserVO)  
            Browser-\>\>User: 9.10 显示注册成功，跳转到登录页  
        end  
    end

**文字说明 (用户成功注册):**

1. 用户在浏览器中填写注册信息。  
2. 前端进行基本的数据格式校验。  
3. 校验通过后，前端将注册信息（RegisterDTO）通过POST请求发送到UserController的注册接口。  
4. UserController调用UserService的register方法。  
5. UserService首先调用UserMapper检查用户名是否已存在。  
6. UserMapper查询数据库。  
7. 数据库返回查询结果。  
8. (场景分支：用户名已存在) 如果用户名已存在，Service层抛出异常，Controller层捕获并返回409错误给前端。  
9. (场景分支：用户名可用)  
   * UserService调用PasswordEncoder对原始密码进行加密。  
   * UserService构建UserEntity对象，并将加密后的密码存入。  
   * UserService调用UserMapper将新的用户实体插入数据库。  
   * 数据库执行插入操作。  
   * 操作成功后，UserService将新创建的用户信息（不含密码，封装为UserVO）返回给UserController。  
   * UserController返回HTTP 201 (Created) 状态码和UserVO给前端。  
   * 前端显示注册成功，并通常会引导用户到登录页面。

##### **4.6.2 用例场景2: 用户发布一条“课程辅导”互助信息**

sequenceDiagram  
    actor User as "用户"  
    participant Browser as "浏览器 (VueApp)"  
    participant HelpInfoCtrl as "HelpInfoController"  
    participant HelpInfoService as "HelpInfoService"  
    participant UserAuthService as "UserAuthService (获取当前用户)"  
    participant HelpInfoMapper as "HelpInfoMapper"  
    participant DB as "MySQL数据库"

    User-\>\>Browser: 1\. 填写互助信息表单 (类型=课程辅导, 标题, 描述等)  
    Browser-\>\>Browser: 2\. 前端校验  
    Browser-\>\>HelpInfoCtrl: 3\. POST /api/help-infos (HelpInfoPublishDTO, JWT in Header)  
    HelpInfoCtrl-\>\>UserAuthService: 4\. getCurrentUserId() (从JWT解析)  
    UserAuthService--\>\>HelpInfoCtrl: 5\. 返回 publisherId  
    HelpInfoCtrl-\>\>HelpInfoService: 6\. publishHelpInfo(dto, publisherId)  
    HelpInfoService-\>\>HelpInfoService: 7\. 数据校验, 敏感词过滤 (可选)  
    HelpInfoService-\>\>HelpInfoService: 8\. 构建 HelpInfoEntity (设置type, title, description, publisherId, status=OPEN, createdAt等)  
    HelpInfoService-\>\>HelpInfoMapper: 9\. insert(helpInfoEntity)  
    HelpInfoMapper-\>\>DB: 10\. INSERT INTO help\_info (...) VALUES (...)  
    DB--\>\>HelpInfoMapper: 11\. 插入成功 (返回生成ID的HelpInfoEntity)  
    HelpInfoMapper--\>\>HelpInfoService: 12\. 返回 HelpInfoEntity  
    HelpInfoService--\>\>HelpInfoCtrl: 13\. 返回 HelpInfoDetailVO  
    HelpInfoCtrl--\>\>Browser: 14\. HTTP 201 Created (HelpInfoDetailVO)  
    Browser-\>\>User: 15\. 显示发布成功提示, 跳转到信息详情页或列表页

**文字说明 (用户发布互助信息):**

1. 用户在前端填写互助信息表单。  
2. 前端进行数据校验。  
3. 校验通过后，前端将信息（HelpInfoPublishDTO）和JWT通过POST请求发送到HelpInfoController。  
4. HelpInfoController (或通过Spring Security的机制) 从JWT中解析出当前登录用户的ID (publisherId)。  
5. Controller调用HelpInfoService的publishHelpInfo方法，传入DTO和发布者ID。  
6. HelpInfoService进行更详细的业务校验（如内容合法性、敏感词过滤等）。  
7. Service构建HelpInfoEntity对象，设置各项属性，并将初始状态设为“OPEN”。  
8. Service调用HelpInfoMapper将实体插入数据库。  
9. 数据库执行插入操作。  
10. 操作成功后，Service将新创建的互助信息（封装为HelpInfoDetailVO）返回给Controller。  
11. Controller返回HTTP 201 (Created) 和HelpInfoDetailVO给前端。  
12. 前端显示发布成功，并通常会跳转到该信息的详情页或互助信息列表页。

### **5\. 前端设计概要**

#### **5.1 视图组件划分 (示例)**

前端将采用组件化开发思想，将UI拆分为可复用的组件。

* **Layouts (布局组件)**:  
  * MainLayout.vue: 主要应用布局，包含顶部导航栏 (NavBar.vue)、侧边栏 (可选)、内容区域 (\<router-view\>)、页脚 (Footer.vue)。  
  * AuthLayout.vue: 用于登录、注册等认证页面的简化布局。  
  * UserProfileLayout.vue: 用户个人中心页面的特定布局。  
* **Views/Pages (页面级组件)**: 每个路由对应一个页面组件。  
  * Home.vue: 平台首页，展示概览信息、热门互助等。  
  * Login.vue, Register.vue, ForgotPassword.vue  
  * UserProfile.vue (查看用户资料), EditProfile.vue (编辑用户资料)  
  * HelpInfoList.vue (互助信息列表，支持筛选和排序)  
  * HelpInfoDetail.vue (互助信息详情页，包含申请按钮、评论区等)  
  * PublishHelpInfo.vue (发布/编辑互助信息表单页)  
  * MyHelpInfos.vue (我发布的/我申请的互助信息管理)  
  * StudyGroupList.vue (学习小组列表)  
  * StudyGroupDetail.vue (小组详情页，包含小组信息、成员列表、帖子列表、文件共享区)  
  * CreateStudyGroup.vue (创建/编辑学习小组表单页)  
  * GroupPostDetail.vue (小组帖子详情页)  
  * SharedResourceList.vue, SharedResourceDetail.vue  
  * Notifications.vue (消息通知中心)  
* **Common Components (通用基础组件)**: 在多个页面或组件中复用的UI元素。  
  * NavBar.vue: 顶部导航栏。  
  * Footer.vue: 页脚。  
  * HelpInfoCard.vue: 用于在列表中展示单个互助信息的卡片。  
  * GroupCard.vue: 用于在列表中展示单个学习小组的卡片。  
  * PostItem.vue: 展示单个帖子的摘要或完整内容。  
  * CommentList.vue, CommentItem.vue: 评论列表和单条评论组件。  
  * FileUpload.vue: 基于ElementPlus封装的文件上传组件。  
  * Pagination.vue: 分页组件。  
  * SearchInput.vue: 搜索输入框组件。  
  * UserAvatar.vue: 用户头像展示组件。

#### **5.2 状态管理 (Pinia)**

使用Pinia进行全局和模块化的状态管理。

* **authStore**:  
  * state: token (String), currentUser (Object | null), isAuthenticated (Boolean)。  
  * getters: getUserRole, isUserLoggedIn。  
  * actions: login(credentials), register(userInfo), logout(), fetchCurrentUser()。  
* helpInfoStore **(可选，如果列表页筛选复杂或多处共享)**:  
  * state: helpInfos (Array), filters (Object), pagination (Object)。  
  * actions: fetchHelpInfos(params), publishHelpInfo(data)。  
* **notificationStore**:  
  * state: notifications (Array), unreadCount (Number)。  
  * actions: fetchNotifications(), markAsRead(notificationId), clearAllNotifications()。  
* **uiStore (可选)**:  
  * state: isLoading (Boolean), globalError (String | null)。  
  * actions: setLoading(status), setError(message)。

#### **5.3 路由设计 (Vue Router)**

使用Vue Router定义前端路由，实现单页面应用的导航。

* **路由模式**: History模式 (需要服务器配置支持)。  
* **路由表 (router/index.js) 示例**:  
  const routes \= \[  
    { path: '/', name: 'Home', component: Home },  
    { path: '/login', name: 'Login', component: Login, meta: { layout: AuthLayout, guestOnly: true } },  
    { path: '/register', name: 'Register', component: Register, meta: { layout: AuthLayout, guestOnly: true } },  
    { path: '/profile/:userId', name: 'UserProfile', component: UserProfile, meta: { requiresAuth: true } },  
    { path: '/profile/edit', name: 'EditProfile', component: EditProfile, meta: { requiresAuth: true } },  
    { path: '/help-infos', name: 'HelpInfoList', component: HelpInfoList },  
    { path: '/help-infos/publish', name: 'PublishHelpInfo', component: PublishHelpInfo, meta: { requiresAuth: true } },  
    { path: '/help-infos/:id', name: 'HelpInfoDetail', component: HelpInfoDetail, props: true },  
    { path: '/study-groups', name: 'StudyGroupList', component: StudyGroupList },  
    { path: '/study-groups/create', name: 'CreateStudyGroup', component: CreateStudyGroup, meta: { requiresAuth: true } },  
    { path: '/study-groups/:id', name: 'StudyGroupDetail', component: StudyGroupDetail, props: true },  
    // ... 其他路由  
    { path: '/notifications', name: 'Notifications', component: Notifications, meta: { requiresAuth: true } },  
    { path: '/:pathMatch(.\*)\*', name: 'NotFound', component: NotFoundPage } // 404页面  
  \];

* **路由守卫 (beforeEach)**:  
  * 检查 meta.requiresAuth，如果需要认证且用户未登录（通过authStore判断），则重定向到登录页。  
  * 检查 meta.guestOnly，如果用户已登录，则重定向到首页或仪表盘。

### **6\. 后端详细设计**

#### **6.1 Controller层设计**

* **职责**: 接收HTTP请求，参数校验，调用Service层处理业务，组装并返回HTTP响应。  
* **注解**: 使用 @RestController 标记类，@RequestMapping("/api/模块名") 定义模块基础路径。  
  * @GetMapping, @PostMapping, @PutMapping, @DeleteMapping 映射具体HTTP方法和路径。  
  * @PathVariable 获取路径参数，@RequestParam 获取查询参数，@RequestBody 获取请求体 (通常是JSON)。  
* **参数校验**: 使用JSR 303/380 (Bean Validation) 注解 (如 @NotNull, @Size, @Email) 对DTO进行校验，并在方法参数上使用 @Valid 注解。校验失败时由全局异常处理器统一返回错误信息。  
* **统一响应**: 所有接口返回统一的 R 对象（见common包设计），包含状态码、消息和数据。  
  // R.java 示例  
  public class R\<T\> {  
      private int code;  
      private String message;  
      private T data;  
      // 构造函数，静态成功/失败方法等  
  }

* **权限控制**: 使用Spring Security的 @PreAuthorize("hasAuthority('ROLE\_USER')") 或 @Secured("ROLE\_ADMIN") 等注解进行接口级别的权限控制。  
* **示例 (UserController.java)**:  
  @RestController  
  @RequestMapping("/api/users")  
  public class UserController {  
      @Autowired private UserService userService;

      @PostMapping("/register")  
      public R\<UserVO\> register(@Valid @RequestBody RegisterDTO registerDTO) {  
          UserVO userVO \= userService.register(registerDTO);  
          return R.created(userVO); // 假设R有静态created方法  
      }  
      // 其他接口...  
  }

#### **6.2 Service层设计**

* **职责**: 实现核心业务逻辑，处理复杂的数据操作和业务规则，管理事务。  
* **接口与实现分离**: 定义Service接口（如 UserService.java），再创建其实现类（如 UserServiceImpl.java）。  
  * 接口: @Service (Spring管理的Bean)。  
  * 实现类: @Service。  
* **事务管理**: 在实现类的公共方法上使用 @Transactional 注解来声明事务边界。默认情况下，遇到运行时异常会回滚事务。可以配置传播行为、隔离级别、只读事务等。  
* **依赖注入**: 通过 @Autowired 注入Mapper接口、其他Service接口或工具类。  
* **业务逻辑**: 包括数据校验（更细致的业务规则校验）、调用一个或多个Mapper方法、调用其他Service方法、组合数据、处理业务异常等。  
* **DTO与Entity转换**: Service层负责DTO到Entity的转换（用于持久化）和Entity到VO/DTO的转换（用于返回给Controller或内部流转）。可以使用MapStruct等工具简化转换代码。

#### **6.3 Mapper层设计**

* **职责**: 数据持久化接口，直接与数据库交互。  
* **技术**: 使用MyBatisPlus。Mapper接口继承 BaseMapper\<Entity\>，即可获得大部分单表CRUD功能。  
  // UserMapper.java  
  @Mapper  
  public interface UserMapper extends BaseMapper\<User\> {  
      // 自定义SQL查询方法 (如果需要复杂查询)  
      UserVO findUserProfileById(@Param("userId") Long userId);  
  }

* **自定义SQL**: 对于复杂的多表连接查询或特定业务逻辑的SQL，可以在Mapper接口中定义方法，并在对应的XML映射文件 (src/main/resources/mapper/\*.xml) 中编写SQL语句。  
  \<mapper namespace="com.campusbuddy.mapper.UserMapper"\>  
      \<select id="findUserProfileById" resultType="com.campusbuddy.vo.UserProfileVO"\>  
          SELECT u.user\_id, u.nickname, u.avatar\_url, ...   
          FROM user u   
          WHERE u.user\_id \= \#{userId}  
      \</select\>  
  \</mapper\>

* **注解**: MyBatisPlus也支持使用注解（如 @Select, @Insert）在接口方法上直接编写SQL，适用于简单SQL。

#### **6.4 DTO与VO设计**

* **DTO (Data Transfer Object)**:  
  * **用途**: 主要用于Controller接收前端传入的数据，或Service层内部方法间传递数据。  
  * **特点**: 通常只包含数据字段和getter/setter，不含业务逻辑。字段与前端表单或请求体结构对应。可能包含JSR 303校验注解。  
  * **示例**: RegisterDTO { username, password, nickname }, HelpInfoPublishDTO { title, description, type, ... }  
* **VO (View Object)**:  
  * **用途**: 主要用于Controller向前端返回的数据，是前端页面展示所需的数据结构。  
  * **特点**: 根据UI展示需求定制，可能包含来自多个Entity的字段，或者对Entity字段进行格式化（如日期格式化、枚举转义为文本）。  
  * **示例**: UserProfileVO { userId, nickname, avatarUrl, major, grade, skillTagsList, creditScore }, HelpInfoDetailVO { infoId, title, descriptionHtml, publisherNickname, publisherAvatar, typeText, statusText, createdAtFormatted, ... }

### **7\. 数据库设计**

#### **7.1 表结构设计**

数据库表结构基于4.2节的类图进行设计。每个\<\<Entity\>\>类对应一张数据库表。主键统一使用BIGINT类型的自增ID。公共字段包括created\_at (创建时间, DATETIME, DEFAULT CURRENT\_TIMESTAMP) 和 updated\_at (更新时间, DATETIME, DEFAULT CURRENT\_TIMESTAMP ON UPDATE CURRENT\_TIMESTAMP)。  
**示例 \- user 表 (用户表)**

| 列名 | 数据类型 | 约束/索引 | 描述 |
| :---- | :---- | :---- | :---- |
| user\_id | BIGINT | PRIMARY KEY, AUTO\_INCREMENT | 用户ID (主 |

